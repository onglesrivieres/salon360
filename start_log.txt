 gateway Skipped - Image is already present locally 
 api Skipped - Image is already present locally 
 mailpit Skipped - Image is already present locally 
 analytics Skipped - Image is already present locally 
 vector Skipped - Image is already present locally 
 db Skipped - Image is already present locally 
 storage Skipped - Image is already present locally 
 pgmeta Skipped - Image is already present locally 
 auth Skipped - Image is already present locally 
 realtime Skipped - Image is already present locally 
 imgProxy Skipped - Image is already present locally 
 edgeRuntime Skipped - Image is already present locally 
 studio Skipped - Image is already present locally 
Starting database...
Initialising schema...
Seeding globals from roles.sql...
Skipping migration _TEMPLATE.sql... (file name must match pattern "<timestamp>_name.sql")
Applying migration 20251017221509_create_initial_schema.sql...
Applying migration 20251018192334_add_customer_type_to_sale_tickets.sql...
Applying migration 20251018205246_add_addons_to_ticket_items.sql...
Applying migration 20251019180341_remove_commission_and_payout_fields.sql...
Applying migration 20251020065849_add_pin_authentication.sql...
Applying migration 20251020070519_add_role_permissions.sql...
Applying migration 20251020072200_create_multi_store_schema.sql...
Applying migration 20251020073535_20251020072800_fix_stores_rls.sql...
Applying migration 20251020074037_20251020073535_fix_stores_rls_for_anon.sql...
Applying migration 20251020075933_add_employee_stores_junction_table.sql...
Applying migration 20251020080544_remove_default_store_id_column.sql...
Applying migration 20251020081016_fix_employee_stores_rls_for_anon.sql...
Applying migration 20251020085819_remove_subtotal_columns.sql...
Applying migration 20251020090627_add_customer_phone_field.sql...
Applying migration 20251020093916_add_multiple_roles_support.sql...
Applying migration 20251020094648_add_ticket_audit_fields.sql...
Applying migration 20251020095111_create_ticket_activity_log.sql...
Applying migration 20251020095524_fix_activity_log_rls_for_anon.sql...
Applying migration 20251020095536_backfill_existing_ticket_activities.sql...
Applying migration 20251020101619_add_pin_verification_function.sql...
Applying migration 20251020101643_add_pin_management_functions.sql...
Applying migration 20251020101711_enable_pgcrypto_extension.sql...
NOTICE (42710): extension "pgcrypto" already exists, skipping
Applying migration 20251020101731_fix_pin_functions_with_pgcrypto_schema.sql...
Applying migration 20251020103000_create_technician_ready_queue.sql...
Applying migration 20251020103100_create_queue_triggers.sql...
NOTICE (00000): trigger "ticket_items_mark_busy" for relation "ticket_items" does not exist, skipping
NOTICE (00000): trigger "sale_tickets_mark_available" for relation "sale_tickets" does not exist, skipping
Applying migration 20251020110152_add_estimated_completion_time_to_technician_queue.sql...
Applying migration 20251020110447_add_service_popularity_function.sql...
Applying migration 20251020110715_fix_service_popularity_function_types.sql...
Applying migration 20251020110852_fix_usage_count_type_in_popularity_function.sql...
Applying migration 20251020112512_add_pay_type_to_employees.sql...
Applying migration 20251020113941_create_attendance_records_table.sql...
Applying migration 20251020121729_add_set_employee_pin_function.sql...
Applying migration 20251020122319_create_attendance_comments_table.sql...
Applying migration 20251020122436_update_get_store_attendance_with_record_id.sql...
Applying migration 20251020123439_add_ticket_approval_system.sql...
NOTICE (00000): trigger "trigger_set_approval_deadline" for relation "sale_tickets" does not exist, skipping
Applying migration 20251020123517_create_auto_approval_cron_job.sql...
Applying migration 20251020132722_fix_security_and_performance_issues.sql...
NOTICE (42P07): relation "idx_attendance_comments_employee_id" already exists, skipping
NOTICE (00000): function verify_employee_pin(uuid,text) does not exist, skipping
NOTICE (00000): function get_store_attendance(uuid,date) does not exist, skipping
Applying migration 20251020132957_add_addon_columns_to_ticket_items.sql...
Applying migration 20251020133206_add_customer_type_column.sql...
Applying migration 20251020133356_create_technician_queue_and_sorting_functions.sql...
Stopping containers...
ERROR: cannot change return type of existing function (SQLSTATE 42P13)          
Row type defined by OUT parameters is different.                                
At statement: 0                                                                 
/*                                                                              
  # Create Technician Queue and Sorting Functions                               
                                                                                
  ## Overview                                                                   
  Creates missing database functions for the ticket editor:                     
  - get_sorted_technicians_for_store: Returns technicians sorted by queue status
  - get_services_by_popularity: Returns services sorted by usage count          
                                                                                
  ## New Functions                                                              
                                                                                
  ### get_sorted_technicians_for_store                                          
  Returns technicians with queue status and position for smart assignment:      
  - Shows ready technicians first (in queue order)                              
  - Then neutral technicians (not in queue, no open tickets)                    
  - Finally busy technicians (with open tickets)                                
                                                                                
  ### get_services_by_popularity                                                
  Returns services sorted by usage frequency:                                   
  - Most used services appear first                                             
  - Helps receptionists quickly find common services                            
                                                                                
  ## Security                                                                   
  - Functions are accessible to all users (internal salon app)                  
  - Uses existing RLS policies on underlying tables                             
*/                                                                              
                                                                                
-- Function: Get services sorted by popularity (usage count)                    
CREATE OR REPLACE FUNCTION get_services_by_popularity(                          
  p_store_id uuid DEFAULT NULL                                                  
)                                                                               
RETURNS TABLE (                                                                 
  id uuid,                                                                      
  code text,                                                                    
  name text,                                                                    
  base_price numeric,                                                           
  duration_min integer,                                                         
  category text,                                                                
  active boolean,                                                               
  created_at timestamptz,                                                       
  updated_at timestamptz,                                                       
  usage_count bigint                                                            
)                                                                               
LANGUAGE plpgsql                                                                
STABLE                                                                          
SET search_path = public, pg_temp                                               
AS $$                                                                           
BEGIN                                                                           
  RETURN QUERY                                                                  
  WITH service_usage AS (                                                       
    SELECT                                                                      
      ti.service_id,                                                            
      SUM(ti.qty) as total_usage                                                
    FROM ticket_items ti                                                        
    JOIN sale_tickets st ON ti.sale_ticket_id = st.id                           
    WHERE (p_store_id IS NULL OR st.store_id = p_store_id)                      
    GROUP BY ti.service_id                                                      
  )                                                                             
  SELECT                                                                        
    s.id,                                                                       
    s.code,                                                                     
    s.name,                                                                     
    s.base_price,                                                               
    s.duration_min,                                                             
    s.category,                                                                 
    s.active,                                                                   
    s.created_at,                                                               
    s.updated_at,                                                               
    COALESCE(su.total_usage, 0) as usage_count                                  
  FROM services s                                                               
  LEFT JOIN service_usage su ON s.id = su.service_id                            
  WHERE s.active = true                                                         
  ORDER BY                                                                      
    COALESCE(su.total_usage, 0) DESC,                                           
    s.code ASC;                                                                 
END;                                                                            
$$                                                                              
Try rerunning the command with --debug to troubleshoot the error.
