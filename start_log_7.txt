 gateway Skipped - Image is already present locally 
 realtime Skipped - Image is already present locally 
 storage Skipped - Image is already present locally 
 imgProxy Skipped - Image is already present locally 
 analytics Skipped - Image is already present locally 
 mailpit Skipped - Image is already present locally 
 api Skipped - Image is already present locally 
 edgeRuntime Skipped - Image is already present locally 
 studio Skipped - Image is already present locally 
 db Skipped - Image is already present locally 
 auth Skipped - Image is already present locally 
 pgmeta Skipped - Image is already present locally 
 vector Skipped - Image is already present locally 
Starting database...
Initialising schema...
Seeding globals from roles.sql...
Skipping migration _TEMPLATE.sql... (file name must match pattern "<timestamp>_name.sql")
Applying migration 20251017221509_create_initial_schema.sql...
Applying migration 20251018192334_add_customer_type_to_sale_tickets.sql...
Applying migration 20251018205246_add_addons_to_ticket_items.sql...
Applying migration 20251019180341_remove_commission_and_payout_fields.sql...
Applying migration 20251020065849_add_pin_authentication.sql...
Applying migration 20251020070519_add_role_permissions.sql...
Applying migration 20251020072200_create_multi_store_schema.sql...
Applying migration 20251020073535_20251020072800_fix_stores_rls.sql...
Applying migration 20251020074037_20251020073535_fix_stores_rls_for_anon.sql...
Applying migration 20251020075933_add_employee_stores_junction_table.sql...
Applying migration 20251020080544_remove_default_store_id_column.sql...
Applying migration 20251020081016_fix_employee_stores_rls_for_anon.sql...
Applying migration 20251020085819_remove_subtotal_columns.sql...
Applying migration 20251020090627_add_customer_phone_field.sql...
Applying migration 20251020093916_add_multiple_roles_support.sql...
Applying migration 20251020094648_add_ticket_audit_fields.sql...
Applying migration 20251020095111_create_ticket_activity_log.sql...
Applying migration 20251020095524_fix_activity_log_rls_for_anon.sql...
Applying migration 20251020095536_backfill_existing_ticket_activities.sql...
Applying migration 20251020101619_add_pin_verification_function.sql...
Applying migration 20251020101643_add_pin_management_functions.sql...
Applying migration 20251020101711_enable_pgcrypto_extension.sql...
NOTICE (42710): extension "pgcrypto" already exists, skipping
Applying migration 20251020101731_fix_pin_functions_with_pgcrypto_schema.sql...
Applying migration 20251020103000_create_technician_ready_queue.sql...
Applying migration 20251020103100_create_queue_triggers.sql...
NOTICE (00000): trigger "ticket_items_mark_busy" for relation "ticket_items" does not exist, skipping
NOTICE (00000): trigger "sale_tickets_mark_available" for relation "sale_tickets" does not exist, skipping
Applying migration 20251020110152_add_estimated_completion_time_to_technician_queue.sql...
Applying migration 20251020110447_add_service_popularity_function.sql...
Applying migration 20251020110715_fix_service_popularity_function_types.sql...
Applying migration 20251020110852_fix_usage_count_type_in_popularity_function.sql...
Applying migration 20251020112512_add_pay_type_to_employees.sql...
Applying migration 20251020113941_create_attendance_records_table.sql...
Applying migration 20251020121729_add_set_employee_pin_function.sql...
Applying migration 20251020122319_create_attendance_comments_table.sql...
Applying migration 20251020122436_update_get_store_attendance_with_record_id.sql...
Applying migration 20251020123439_add_ticket_approval_system.sql...
NOTICE (00000): trigger "trigger_set_approval_deadline" for relation "sale_tickets" does not exist, skipping
Applying migration 20251020123517_create_auto_approval_cron_job.sql...
Applying migration 20251020132722_fix_security_and_performance_issues.sql...
NOTICE (42P07): relation "idx_attendance_comments_employee_id" already exists, skipping
NOTICE (00000): function verify_employee_pin(uuid,text) does not exist, skipping
NOTICE (00000): function get_store_attendance(uuid,date) does not exist, skipping
Applying migration 20251020132957_add_addon_columns_to_ticket_items.sql...
Applying migration 20251020133206_add_customer_type_column.sql...
Applying migration 20251020133356_create_technician_queue_and_sorting_functions.sql...
Applying migration 20251020133441_fix_technician_and_service_functions.sql...
Applying migration 20251020133600_create_get_store_attendance_function.sql...
Applying migration 20251020133733_convert_employee_role_to_array.sql...
Applying migration 20251020133803_update_technician_function_for_role_array.sql...
Applying migration 20251020133953_fix_pin_functions_schema_references.sql...
Applying migration 20251020134121_create_verify_pin_by_code_function.sql...
Applying migration 20251020141652_fix_pin_verification_case_sensitivity.sql...
Applying migration 20251020142125_add_performance_indexes.sql...
Applying migration 20251020142219_fix_pending_approvals_performance.sql...
Applying migration 20251020145644_add_missing_approval_functions.sql...
Applying migration 20251020145719_add_approval_trigger_and_backfill.sql...
Applying migration 20251020145933_add_auto_approval_logging_function.sql...
Applying migration 20251020150250_fix_technician_queue_status_updates.sql...
Applying migration 20251020150318_create_queue_management_triggers.sql...
Applying migration 20251020173347_update_attendance_function_for_technician_filtering.sql...
Applying migration 20251020173919_add_join_ready_queue_function.sql...
Applying migration 20251020180000_add_completed_status_to_tickets.sql...
Applying migration 20251020190334_update_join_ready_queue_to_complete_tickets.sql...
Applying migration 20251020191007_fix_pending_approvals_for_technician.sql...
Applying migration 20251020191254_fix_approve_ticket_logic.sql...
Applying migration 20251020192555_add_requires_higher_approval_for_dual_role_closers.sql...
Applying migration 20251020192621_update_pending_approvals_for_higher_approval.sql...
Applying migration 20251020192642_update_approve_ticket_for_higher_approval.sql...
Applying migration 20251020193435_add_supervisor_role.sql...
Applying migration 20251020194215_update_supervisor_approval_logic.sql...
Applying migration 20251020194238_update_pending_approvals_for_supervisor_logic.sql...
Applying migration 20251020194256_update_management_approvals_for_supervisor.sql...
Applying migration 20251020194702_include_supervisors_in_technician_list.sql...
Applying migration 20251020195034_fix_technician_status_case_sensitivity.sql...
Applying migration 20251020195420_normalize_employee_status_casing.sql...
Applying migration 20251020234133_add_card_tip_columns_to_ticket_items.sql...
Applying migration 20251021000000_update_auto_checkout_logic.sql...
Applying migration 20251021000100_create_auto_checkout_cron.sql...
NOTICE (42710): extension "pg_cron" already exists, skipping
Applying migration 20251022185422_add_queue_check_and_leave_functions.sql...
Applying migration 20251022201133_fix_queue_position_numbering.sql...
Applying migration 20251022201552_support_multiple_attendance_sessions_per_day.sql...
Applying migration 20251023042631_add_daily_auto_checkout_at_2130_eastern.sql...
Applying migration 20251023042652_fix_auto_checkout_timezone_handling.sql...
Applying migration 20251023043017_add_auto_queue_release_at_closing.sql...
Applying migration 20251023043051_update_auto_checkout_for_varying_closing_times.sql...
Applying migration 20251023051851_rename_tip_columns_and_remove_receptionist_card.sql...
Applying migration 20251023052731_fix_tip_column_references_in_functions.sql...
Applying migration 20251023142224_add_store_opening_time_and_checkin_validation.sql...
Applying migration 20251023144226_add_day_specific_opening_hours.sql...
Applying migration 20251023144801_filter_attendance_by_role.sql...
Applying migration 20251024051139_add_service_completion_tracking.sql...
Applying migration 20251024052012_revert_to_completed_at_stops_timer.sql...
Applying migration 20251024053008_20251024120000_add_countdown_fields_to_technician_function.sql...
Applying migration 20251024053411_20251024130000_add_spa_expert_role.sql...
Applying migration 20251024053451_20251024130100_update_functions_for_spa_expert.sql...
Applying migration 20251024053523_20251024130200_update_attendance_for_spa_expert.sql...
Applying migration 20251024054514_20251024140000_add_spa_expert_to_role_constraint.sql...
Applying migration 20251024172510_fix_timer_stop_for_busy_technicians.sql...
Applying migration 20251024172541_fix_timer_stop_with_proper_uuid_handling.sql...
Applying migration 20251024184244_add_custom_service_support_to_ticket_items.sql...
Applying migration 20251024193228_add_discount_fields_to_ticket_items.sql...
Applying migration 20251024212935_add_reset_employee_pin_function.sql...
Applying migration 20251024213151_fix_reset_employee_pin_pgcrypto_reference.sql...
Applying migration 20251025135332_implement_role_based_approval_logic.sql...
Applying migration 20251025135954_fix_supervisor_approval_routing.sql...
Applying migration 20251025141112_comprehensive_approval_fix.sql...
Applying migration 20251025141645_nuclear_approval_fix.sql...
Applying migration 20251025142254_smart_approval_routing.sql...
NOTICE (00000): Starting approval routing fix for all pending tickets...
NOTICE (00000): Fixed 0 pending approval tickets
Applying migration 20251025143000_final_approval_fix.sql...
Applying migration 20251025143742_20251025143636_fix_supervisor_approval_routing_final.sql...
Stopping containers...
ERROR: cannot change return type of existing function (SQLSTATE 42P13)                         
Row type defined by OUT parameters is different.                                               
At statement: 2                                                                                
-- ============================================================================                
-- FIX TECHNICIAN APPROVAL FUNCTION                                                            
-- ============================================================================                
                                                                                               
CREATE OR REPLACE FUNCTION get_pending_approvals_for_technician(                               
  p_store_id uuid,                                                                             
  p_employee_id uuid                                                                           
)                                                                                              
RETURNS TABLE(                                                                                 
  ticket_id uuid,                                                                              
  ticket_no text,                                                                              
  ticket_date date,                                                                            
  closed_at timestamptz,                                                                       
  approval_deadline timestamptz,                                                               
  customer_name text,                                                                          
  customer_phone text,                                                                         
  total numeric,                                                                               
  closed_by_name text,                                                                         
  closed_by_roles jsonb,                                                                       
  hours_remaining numeric,                                                                     
  service_name text,                                                                           
  tip_customer numeric,                                                                        
  tip_receptionist numeric,                                                                    
  payment_method text,                                                                         
  requires_higher_approval boolean,                                                            
  technician_names text,                                                                       
  reason text                                                                                  
)                                                                                              
LANGUAGE plpgsql                                                                               
STABLE                                                                                         
SET search_path = public, pg_temp                                                              
AS $$                                                                                          
BEGIN                                                                                          
  RETURN QUERY                                                                                 
  SELECT                                                                                       
    st.id as ticket_id,                                                                        
    st.ticket_no,                                                                              
    st.ticket_date,                                                                            
    st.closed_at,                                                                              
    st.approval_deadline,                                                                      
    st.customer_name,                                                                          
    st.customer_phone,                                                                         
    st.total,                                                                                  
    COALESCE(e.display_name, 'Unknown') as closed_by_name,                                     
    st.closed_by_roles,                                                                        
    EXTRACT(EPOCH FROM (st.approval_deadline - NOW())) / 3600 as hours_remaining,              
    STRING_AGG(DISTINCT s.name, ', ') as service_name,                                         
    SUM(COALESCE(ti.tip_customer_cash, 0) + COALESCE(ti.tip_customer_card, 0)) as tip_customer,
    SUM(COALESCE(ti.tip_receptionist, 0)) as tip_receptionist,                                 
    st.payment_method,                                                                         
    COALESCE(st.requires_higher_approval, false) as requires_higher_approval,                  
    STRING_AGG(DISTINCT emp.display_name, ', ') as technician_names,                           
    'Requires your approval' as reason                                                         
  FROM sale_tickets st                                                                         
  LEFT JOIN employees e ON st.closed_by = e.id                                                 
  INNER JOIN ticket_items ti ON ti.sale_ticket_id = st.id                                      
  LEFT JOIN services s ON ti.service_id = s.id                                                 
  LEFT JOIN employees emp ON ti.employee_id = emp.id                                           
  WHERE st.store_id = p_store_id                                                               
    AND st.approval_status = 'pending_approval'                                                
    AND st.closed_at IS NOT NULL                                                               
    AND st.approval_deadline > NOW()                                                           
    -- Show if this technician worked on it                                                    
    AND ti.employee_id = p_employee_id                                                         
    -- Don't show if they closed it (can't self-approve)                                       
    AND st.closed_by != p_employee_id                                                          
    -- Show normal technician approvals (not escalated to management)                          
    AND COALESCE(st.requires_higher_approval, false) = false                                   
  GROUP BY st.id, e.display_name                                                               
  ORDER BY st.approval_deadline ASC;                                                           
END;                                                                                           
$$                                                                                             
Try rerunning the command with --debug to troubleshoot the error.
